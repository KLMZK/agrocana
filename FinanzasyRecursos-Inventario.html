<html>
    <head>
        <title></title>
        <meta charset="UTF-8">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="estilos/pantallasCultivos.css">
        <script type="text/javascript" src="scripts/sesion.js"></script>
        <style>
            .seleccion button{
                width: 130px;
            }
            .seleccion button:hover{
                width: 130px;
            }
            .seleccion button.activo{
                width: 130px;
            }
            .seleccion{
                width: 410px;
                height:3px;
            }
            .tabla-inventario {
                display: block;
                max-height: 400px;
                overflow-y: auto;
            }
            .tabla-inventario thead, 
            .tabla-inventario tbody tr {
                display: table;
                width: 100%;
                table-layout: fixed; 
            }
        </style>
    </head>
    <body>
        <h1> Finanzas y Recursos</h1>
        <h2>Control de  presupuesto, transporte e inventario</h2>

        <div class="contenedor">
            <div class="cuadros">
                <p style="font-weight: bold;">Total Ingresos</p>
                <text id="ingresosMes" style="color:#316C1B; font-size:25px; margin-top: 30px;">Cargando...</text><br>
                <text style="color:#8B8383; font-size: 14px; margin-top: -15px;">Mes actual</text>
            </div>
            <div class="cuadros">
                <p style="font-weight: bold;">Total Gastos</p>
                <text id="gastosMes" style="color:#C51B1B; font-size: 25px; margin-top: 30px;">Cargando...</text><br>
                <text style="color:#8B8383; font-size: 14px; margin-top: -15px;">Mes actual</text>
            </div>
            <div class="cuadros">
                <p style="font-weight: bold;">Balance</p>
                <text id="balanceMes" style="color:#316C1B; font-size: 25px; margin-top: 30px;">Cargando...</text><br>
                <text style="color:#8B8383; font-size: 14px; margin-top: -15px;">Resultado Neto</text>
            </div>
        </div>


        <div class="seleccion" style="gap:10px;">
            <form action="FinanzasyRecursos-Presupuesto.html" style="margin-top: 17px;">
                <button>
                    <img src="iconos/dolar.png" alt="Icono dolar" width="14" height="14">  
                    Presupuesto</button>
            </form>
            <form action="FinanzasyRecursos-Transporte.html" style="margin-top: 17px;">
            <button><img src="iconos/camion.png" alt="Icono Transporte" width="14" height="14">  
                Transporte</button>
            </form>
            <form action="FinanzasyRecursos-Inventario.html" style="margin-top: 17px;">
                <button class="activo">
                 <img src="iconos/proveedor2.png" alt="Icono inventario" width="14" height="14">  
                Inventario</button>
            </form>
        </div>
            <div class="contenido" style="height: 500px; gap: 5px;">
                <div class="arriba" style="justify-content: space-between; padding-bottom: 5px; margin-bottom:0 ;">
                <text>Inventario y Herramientas</text>
                <div class="bot">
                    <form action="FinanzasyRecursos-FormularioRegistrarItem.html">
                        <button><img src="iconos/anadir.png" alt="anadir"  width="14" height="14">Registrar Ítem</button>
                    </form>
                    <form action="FinanzasyRecursos-FormularioAgregarItem.html">
                        <button><img src="iconos/anadir.png" alt="anadir"  width="14" height="14">Agregar Ítem</button>
                    </form>
                </div>
                </div>
                <table class="tabla-inventario" style="margin-top: 10px;">
                    <tr>
                        <th style="font-size: 14px;">Nombre</th>
                        <th style="font-size: 14px;">Categoría</th>
                        <th style="font-size: 14px;">Cantidad</th>
                        <th style="font-size: 14px;">Ubicación</th>
                        <th style="font-size: 14px;">Estado</th>
                        <th style="font-size: 14px;">Acciones</th>
                    </tr>
                  <tbody id="tablaInventario"></tbody>
                </table>
            </div>
            <script>
                let ingresos = 0;
                let gastos = 0;

                const Ingr = fetch("php/finanzasyrecursos/FinanzasyRecursos_VistaIngreso.php")
                    .then(res => res.json())
                    .then(data => {
                        ingresos = Number(data.totalIngresos);
                        document.getElementById("ingresosMes").textContent =
                            "$" + ingresos.toLocaleString();
                    });
                const Gast = fetch("php/finanzasyrecursos/FinanzasyRecursos_VistaGasto.php")
                    .then(res => res.json())
                    .then(data => {
                        gastos = Number(data.totalGastos);
                        document.getElementById("gastosMes").textContent =
                            "$" + gastos.toLocaleString();
                    });

                Promise.all([Ingr, Gast]).then(() => {
                    const balance = ingresos - gastos;

                    document.getElementById("balanceMes").textContent =
                        "$" + balance.toLocaleString();
                    if (balance < 0) {
                        document.getElementById("balanceMes").style.color = "#C51B1B";
                    } else {
                        document.getElementById("balanceMes").style.color = "#346E19"; 
                    }
                });
                fetch("php/finanzasyrecursos/FinanzasyRecursos-ConsultaInventario.php")
                    .then(res => res.json())
                    .then(data => {
                        let tabla = document.getElementById("tablaInventario");
                        tabla.innerHTML = "";
                        data.forEach(inventario => {
                            tabla.innerHTML += `
                                <tr>
                                    <td>${inventario.NOMBRE}</td>
                                    <td>${inventario.CATEGORIA}</td>
                                    <td>${inventario.CANTIDAD}</td>
                                    <td>${inventario.UBICACION}</td>
                                    <td>${inventario.ESTADO}</td>
                                    <td class="acciones">
                                        <button class="Boton-icono" onclick="cambiarEstado('${inventario.CVE_ITEM}')"><img src="iconos/cambiar.png"></button>
                                        <button type="button" class="Boton-icono" onclick="window.location.href='FinanzasyRecursos-EditarAgregarItem.html?id=${inventario.CVE_ITEM}'"><img src="iconos/editar.png"></button>
                                        <button class="Boton-icono" onclick="eliminar('${inventario.CVE_ITEM}')"><img src="iconos/eliminar.png"></button>
                                    </td>
                                </tr>
                            `;
                        });
                    });
                function cambiarEstado(id) {
                    fetch("php/finanzasyrecursos/FinanzasyRecursos-CambiarEstadoItem.php", {
                        method: "POST",
                        headers: {"Content-Type": "application/x-www-form-urlencoded"},
                        body: "id=" + encodeURIComponent(id)
                    })
                    .then(res => res.text())
                    .then(resp => {
                        alert(resp);
                        location.reload();
                    });
                }
                function eliminar(id) {
                    if(confirm("¿Estás seguro de que deseas eliminar este Item?")) {
                        fetch("php/finanzasyrecursos/FinanzasyRecursos-EliminarRegistroItem.php", {
                            method: "POST",
                            headers: {"Content-Type": "application/x-www-form-urlencoded"},
                            body: "id=" + id
                        })
                        .then(res => res.text())
                        .then(resp => {
                            alert(resp);
                            location.reload();
                        });
                    }
                }
            </script>
    </body>
</html>