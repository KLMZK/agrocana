<html>
    <head>
        <title></title>
        <meta charset="UTF-8">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="estilos/pantallasCultivos.css">
        <script type="text/javascript" src="scripts/sesion.js"></script>
        <style>
            .seleccion button{
                width: 130px;
            }
            .seleccion button:hover{
                width: 130px;
            }
            .seleccion button.activo{
                width: 130px;
            }
            .seleccion{
                width: 270px;
                height:3px;
            }
            .categoria,.valor{
                font-family: "Inter", sans-serif;
                font-size: 16px; 
            }
            .info{
                border: 2px solid #D9D9D9;
                background-color: transparent;
                border-radius: 10px;
                padding: 20px;
                font-family: "Inter", sans-serif;
                font-size: 16px; 
                width: 50%;
                height: 600px;
                margin-left: 20px;
                margin-top: 15px;
            }
            .titulo{
                margin-top: 0px;
                margin-bottom: 40px;
                font-family: "Inter", sans-serif;
                font-size: 16px; 
            }
            .gastos{
                margin-bottom: 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .tabla-trabajadores {
                display: block;
                max-height: 400px;
                overflow-y: auto;
            }
            .tabla-trabajadores thead, 
            .tabla-trabajadores tbody tr {
                display: table;
                width: 100%;
                table-layout: fixed; 
            }
        </style>
    </head>
    <body>
        <h1>Personal y Proveedores</h1>
        <h2>Control de trabajadores y comunicación</h2>


        <div class="seleccion" style="gap:10px;">
            <form action="PersonalyProveedores-Trabajadores.html" style="margin-top: 17px;">
            <button class="activo">
                 <img src="iconos/usuario.png" alt="Icono trabajadores" width="14" height="14">  
                Trabajadores</button>
            </form>
            <form action="PersonalyProveedores-Proveedores.html" style="margin-top: 17px;">
                <button>
                    <img src="iconos/proveedor.png" alt="Icono proveedor" width="14" height="14">  
                    Proveedores</button>
            </form>
        </div>
            <div class="contenedor" style="display: block; margin-left: 0;">
                <div class="contenido" style="height: 500px;">
                    <div class="arriba" style="justify-content: space-between; padding-bottom: 5px; margin-bottom:0 ;">
                        <text>Registro de Trabajadores</text>
                        <div class="bot">
                            <form action="PersonalyProveedores-FormularioAgregarTrabajadores.html">
                                <button ><img src="iconos/anadir.png" alt="anadir"  width="14" height="14">Agregar Trabajador</button>
                            </form>
                        </div>
                    </div>
                    <table class="tabla-trabajadores" style="margin-top: 10px;">
                        <tr>
                            <th style="font-size: 14px;">Nombre</th>
                            <th style="font-size: 14px;">Tipo</th>
                            <th style="font-size: 14px;">Rol</th>
                            <th style="font-size: 14px;">Contacto</th>
                            <th style="font-size: 14px;">Estado</th>
                            <th style="font-size: 14px;">Acciones</th>
                        </tr>
                        <tbody id="tablaTrabajadores">
                        </tbody>
                    </table>
                </div>
                <div class="info">
                    <p class="titulo">Resumen del Personal</p>
                    <div class="gastos">
                        <text class="categoria">Total de trabajadores</text>
                        <text class="valor" id="totalTrabajadores">0<br></text>
                    </div>
                    <div class="gastos">
                        <text class="categoria">Permanentes</text>
                        <text class="valor" id="totalPermanentes">0<br></text>
                    </div>
                    <div class="gastos">
                        <text class="categoria">Temporales</text>
                        <text class="valor" id="totalTemporales">0<br></text>
                    </div>
                    <div class="gastos" style="border-top: 1px solid #D9D9D9; padding-top: 20px;">
                        <text class="categoria">Activos hoy</text>
                        <text class="valor" id="totalActivos">0<br></text>
                    </div>
                </div>
            </div>
            <script>
                fetch("php/personalyproveedores/PersonalyProveedores_VistaPersonal.php")
                .then(res => res.json())
                .then(data => {
                    document.getElementById("totalTrabajadores").textContent =
                        Number(data.tTrabajadores).toLocaleString();

                    document.getElementById("totalPermanentes").textContent =
                        Number(data.tPermanentes).toLocaleString();

                    document.getElementById("totalTemporales").textContent =
                        Number(data.tTemporales).toLocaleString();

                    document.getElementById("totalActivos").textContent =
                        Number(data.tActivos).toLocaleString();
                });
                fetch("php/personalyproveedores/PersonasyProveedores-ConsultaPersonal.php")
                .then(res => res.json())
                .then(data => {
                    let tabla = document.getElementById("tablaTrabajadores");
                    tabla.innerHTML = "";
                    data.forEach(personal => {
                        tabla.innerHTML += `
                            <tr>
                                <td>${personal.NOMBRE}</td>
                                <td>${personal.TIPO}</td>
                                <td>${personal.ROL}</td>
                                <td>${personal.NUMEROTELEFONICO}</td>
                                <td>${personal.ESTADO}</td>
                                <td class="acciones">
                                    <button class="Boton-icono" onclick="cambiarEstado(${personal.CVE_USUARIO})"><img src="iconos/cambiar.png"></button>
                                    <button type="button" class="Boton-icono" onclick="window.location.href='PersonalyProveedores-EditarAgregarPersonal.html?id=${personal.CVE_USUARIO}'"><img src="iconos/editar.png"></button>
                                    <button class="Boton-icono" onclick="eliminar(${personal.CVE_USUARIO})"><img src="iconos/eliminar.png"></button>
                                </td>
                            </tr>
                        `;
                    });
                });
                function cambiarEstado(id) {
                    fetch("php/personalyproveedores/PersonalyProveedores-CambiarEstadoTrabajadores.php", {
                        method: "POST",
                        headers: {"Content-Type": "application/x-www-form-urlencoded"},
                        body: "id=" + encodeURIComponent(id)
                    })
                    .then(res => res.text())
                    .then(resp => {
                        alert(resp);
                        location.reload();
                    });
                }
                function eliminar(id) {
                    if(confirm("¿Estás seguro de que deseas eliminar este Trabajador?")) {
                        fetch("php/personalyproveedores/PersonalyProveedores-EliminarRegistroTrabajador.php", {
                            method: "POST",
                            headers: {"Content-Type": "application/x-www-form-urlencoded"},
                            body: "id=" + id
                        })
                        .then(res => res.text())
                        .then(resp => {
                            alert(resp);
                            location.reload();
                        });
                    }
                }
            </script>
    </body>
</html>